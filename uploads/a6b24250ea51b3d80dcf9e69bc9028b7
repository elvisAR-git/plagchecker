const express = require("express");
const bodyparser = require("body-parser");
const session = require("express-session");
const redis = require("redis");
const client = redis.createClient();
const redisStore = require("connect-redis")(session);
const carsRoute = require("./cars");

const app = express();

// session management with redis
app.use(
  session({
    secret: "kjh5kj34hjkhfk3l24kljsdklfdjkl",
    store: new redisStore({
      host: "localhost",
      port: 6379,
      client: client,
      ttl: 260,
    }),
    saveUninitialized: false,
    resave: false,
  })
);

// configuring server statics and views

app.set("views", "./views");
app.use(express.static(__dirname + "/public/"));

//  content parsing
app.use(
  bodyparser.urlencoded({
    extended: true,
  })
);
app.use(
  bodyparser.json({
    extended: true,
  })
);

var PORT = 4000 || process.env.PORT;

// ROUTES GO HERE
app.use("/", carsRoute);

app.listen(PORT, () => {
  console.log("API Server is running on port", PORT);
});
